<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Composition | codertao</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="了解真相才能获得真正的自由">
    
    <link rel="preload" href="/assets/css/0.styles.9b7d3967.css" as="style"><link rel="preload" href="/assets/js/app.cce02172.js" as="script"><link rel="preload" href="/assets/js/2.032fb0bf.js" as="script"><link rel="preload" href="/assets/js/31.c07bebee.js" as="script"><link rel="prefetch" href="/assets/js/10.d8f1d890.js"><link rel="prefetch" href="/assets/js/11.39c93d2d.js"><link rel="prefetch" href="/assets/js/12.c2046a5b.js"><link rel="prefetch" href="/assets/js/13.4aa6aba2.js"><link rel="prefetch" href="/assets/js/14.8c348e89.js"><link rel="prefetch" href="/assets/js/15.67da5716.js"><link rel="prefetch" href="/assets/js/16.38de6d77.js"><link rel="prefetch" href="/assets/js/17.de68e383.js"><link rel="prefetch" href="/assets/js/18.ffcb35fb.js"><link rel="prefetch" href="/assets/js/19.c293a8f3.js"><link rel="prefetch" href="/assets/js/20.4ab530a4.js"><link rel="prefetch" href="/assets/js/21.9c537178.js"><link rel="prefetch" href="/assets/js/22.53d48f8d.js"><link rel="prefetch" href="/assets/js/23.054c7aea.js"><link rel="prefetch" href="/assets/js/24.8852dd09.js"><link rel="prefetch" href="/assets/js/25.ac8703c9.js"><link rel="prefetch" href="/assets/js/26.4b01e35e.js"><link rel="prefetch" href="/assets/js/27.1266c52f.js"><link rel="prefetch" href="/assets/js/28.4d1528d3.js"><link rel="prefetch" href="/assets/js/29.ff9a0adf.js"><link rel="prefetch" href="/assets/js/3.c1c781b1.js"><link rel="prefetch" href="/assets/js/30.f6827ee8.js"><link rel="prefetch" href="/assets/js/32.bf23ad86.js"><link rel="prefetch" href="/assets/js/33.0f46e884.js"><link rel="prefetch" href="/assets/js/34.e0ae61ac.js"><link rel="prefetch" href="/assets/js/35.41b47a1e.js"><link rel="prefetch" href="/assets/js/36.8fc3e8af.js"><link rel="prefetch" href="/assets/js/37.77373176.js"><link rel="prefetch" href="/assets/js/38.638c0158.js"><link rel="prefetch" href="/assets/js/39.bfd41933.js"><link rel="prefetch" href="/assets/js/4.c7abab7a.js"><link rel="prefetch" href="/assets/js/40.c898e595.js"><link rel="prefetch" href="/assets/js/41.f517ff43.js"><link rel="prefetch" href="/assets/js/42.7fccb977.js"><link rel="prefetch" href="/assets/js/43.22016df4.js"><link rel="prefetch" href="/assets/js/44.ea73cc06.js"><link rel="prefetch" href="/assets/js/45.c2128fe1.js"><link rel="prefetch" href="/assets/js/46.576e71f2.js"><link rel="prefetch" href="/assets/js/47.28527204.js"><link rel="prefetch" href="/assets/js/48.2979bc6b.js"><link rel="prefetch" href="/assets/js/49.64a2e7e2.js"><link rel="prefetch" href="/assets/js/5.5858aec4.js"><link rel="prefetch" href="/assets/js/50.c12dc9fb.js"><link rel="prefetch" href="/assets/js/51.7bf924a9.js"><link rel="prefetch" href="/assets/js/52.731618a8.js"><link rel="prefetch" href="/assets/js/53.0a222970.js"><link rel="prefetch" href="/assets/js/54.e550d080.js"><link rel="prefetch" href="/assets/js/55.1376558e.js"><link rel="prefetch" href="/assets/js/56.523f0205.js"><link rel="prefetch" href="/assets/js/57.60541360.js"><link rel="prefetch" href="/assets/js/58.7df5fa3f.js"><link rel="prefetch" href="/assets/js/59.990c8d89.js"><link rel="prefetch" href="/assets/js/6.afd64bd9.js"><link rel="prefetch" href="/assets/js/60.9dc8f8b9.js"><link rel="prefetch" href="/assets/js/61.47117dc1.js"><link rel="prefetch" href="/assets/js/62.bbd869e3.js"><link rel="prefetch" href="/assets/js/63.84379b47.js"><link rel="prefetch" href="/assets/js/64.22b4e7df.js"><link rel="prefetch" href="/assets/js/7.f60abe3c.js"><link rel="prefetch" href="/assets/js/8.0a248701.js"><link rel="prefetch" href="/assets/js/9.abb5c751.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9b7d3967.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">codertao</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontEnd/basics/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-subitem"><a href="/frontEnd/basics/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-subitem"><a href="/frontEnd/basics/javascript/" class="nav-link">
  JavaScript
</a></li></ul></li><li class="dropdown-item"><h4>
          JS框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontEnd/frame/vue/" class="nav-link router-link-active">
  Vue
</a></li><li class="dropdown-subitem"><a href="/frontEnd/frame/react/" class="nav-link">
  React
</a></li></ul></li><li class="dropdown-item"><h4>
          打包工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontEnd/pack/webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-subitem"><a href="/frontEnd/pack/vite/" class="nav-link">
  Vite
</a></li></ul></li><li class="dropdown-item"><h4>
          小程序
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/applet/native/" class="nav-link">
  原生
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/dataStructure/" class="nav-link">
  数据结构
</a></div><div class="nav-item"><a href="/share/" class="nav-link">
  优文转载
</a></div><div class="nav-item"><a href="/essay/" class="nav-link">
  随笔
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具箱" class="dropdown-title"><span class="title">工具箱</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具箱" class="mobile-dropdown-title"><span class="title">工具箱</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          在线编辑
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://tinypng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图片压缩
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          日常分享
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mukbang/" class="nav-link">
  吃播集锦
</a></li><li class="dropdown-subitem"><a href="/movies/" class="nav-link">
  电影分享
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/likesandy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontEnd/basics/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-subitem"><a href="/frontEnd/basics/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-subitem"><a href="/frontEnd/basics/javascript/" class="nav-link">
  JavaScript
</a></li></ul></li><li class="dropdown-item"><h4>
          JS框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontEnd/frame/vue/" class="nav-link router-link-active">
  Vue
</a></li><li class="dropdown-subitem"><a href="/frontEnd/frame/react/" class="nav-link">
  React
</a></li></ul></li><li class="dropdown-item"><h4>
          打包工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontEnd/pack/webpack/" class="nav-link">
  Webpack
</a></li><li class="dropdown-subitem"><a href="/frontEnd/pack/vite/" class="nav-link">
  Vite
</a></li></ul></li><li class="dropdown-item"><h4>
          小程序
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/applet/native/" class="nav-link">
  原生
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/dataStructure/" class="nav-link">
  数据结构
</a></div><div class="nav-item"><a href="/share/" class="nav-link">
  优文转载
</a></div><div class="nav-item"><a href="/essay/" class="nav-link">
  随笔
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具箱" class="dropdown-title"><span class="title">工具箱</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具箱" class="mobile-dropdown-title"><span class="title">工具箱</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          在线编辑
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://tinypng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图片压缩
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4>
          日常分享
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/mukbang/" class="nav-link">
  吃播集锦
</a></li><li class="dropdown-subitem"><a href="/movies/" class="nav-link">
  电影分享
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/likesandy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontEnd/frame/vue/" aria-current="page" class="sidebar-link">首页</a></li><li><a href="/frontEnd/frame/vue/component.html" class="sidebar-link">组件化开发</a></li><li><a href="/frontEnd/frame/vue/animation.html" class="sidebar-link">动画</a></li><li><a href="/frontEnd/frame/vue/Composition.html" aria-current="page" class="active sidebar-link">Composition</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontEnd/frame/vue/Composition.html#mixin" class="sidebar-link">Mixin</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frame/vue/Composition.html#extends" class="sidebar-link">extends</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frame/vue/Composition.html#composition-api" class="sidebar-link">Composition API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontEnd/frame/vue/Composition.html#认识-composition-api" class="sidebar-link">认识 Composition API</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frame/vue/Composition.html#reactive-api" class="sidebar-link">Reactive API</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frame/vue/Composition.html#ref-api" class="sidebar-link">Ref API</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frame/vue/Composition.html#readonly" class="sidebar-link">readonly</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frame/vue/Composition.html#reactive-判断的-api" class="sidebar-link">Reactive 判断的 API</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frame/vue/Composition.html#torefs" class="sidebar-link">toRefs</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frame/vue/Composition.html#toref" class="sidebar-link">toRef</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frame/vue/Composition.html#computed" class="sidebar-link">computed</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frame/vue/Composition.html#watcheffect" class="sidebar-link">watchEffect</a></li><li class="sidebar-sub-header"><a href="/frontEnd/frame/vue/Composition.html#watch" class="sidebar-link">Watch</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="mixin"><a href="#mixin" class="header-anchor">#</a> Mixin</h2> <h4 id="认识-mixin"><a href="#认识-mixin" class="header-anchor">#</a> 认识 Mixin</h4> <ul><li>目前我们是使用组件化的方式在开发整个 Vue 的应用程序，但是组件和组件之间有时候会存在相同的代码逻辑，我
们希望对相同的代码逻辑进行抽取。</li> <li>在 Vue2 和 Vue3 中都支持的一种方式就是使用 Mixin 来完成：
<ul><li>Mixin 提供了一种非常灵活的方式，来<strong>分发 Vue 组件中的可复用功能</strong>；</li> <li>一个 Mixin 对象可以包含<strong>任何组件选项</strong>；</li> <li>当组件使用 Mixin 对象时，所有<strong>Mixin 对象的选项将被 混合 进入该组件本身的选项中</strong>；</li></ul></li></ul> <h4 id="mixin-的基本使用"><a href="#mixin-的基本使用" class="header-anchor">#</a> Mixin 的基本使用</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// mixins/demoMixin.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> demoMixin <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Mixin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;执行了demoMixin的created&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>say<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>按钮<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> demoMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./mixins/demoMixin&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  mixins<span class="token operator">:</span> <span class="token punctuation">[</span>demoMixin<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><img src="/frontEnd/frame/vue/63.png" alt=""></p> <h4 id="mixin-的合并规则"><a href="#mixin-的合并规则" class="header-anchor">#</a> Mixin 的合并规则</h4> <ul><li>如果 Mixin 对象中的选项和组件对象中的选项发生了冲突，那么 Vue 会如何操作呢？
<ul><li>这里<strong>分成不同的情况</strong>来进行处理；</li></ul></li> <li>情况一：如果是 data 函数的返回值对象
<ul><li>返回值对象默认情况下会<strong>进行合并</strong>；</li> <li>如果 data 返回值对象的属性发生了冲突，那么会<strong>保留组件自身的数据</strong>；</li></ul></li> <li>情况二：如何生命周期钩子函数
<ul><li>生命周期的钩子函数<strong>会被合并到数组</strong>中，都会被调用；</li> <li>mixin 对象的钩子将在组件自身钩子<strong>之前</strong>调用。</li></ul></li> <li>情况三：值为对象的选项，例如<strong>methods</strong>、<strong>components</strong> 和 <strong>directives</strong>，将被合并为同一个对象。
<ul><li>比如都有<strong>methods 选项</strong>，并且都定义了方法，那么<strong>它们都会生效</strong>；</li> <li>但是如果<strong>对象的 key 相同</strong>，那么<strong>会取组件对象的键值对</strong>；</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// mixins/demoMixin.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> demoMixin <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Mixin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;执行了demoMixin的created&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>say<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>按钮<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> demoMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./mixins/demoMixin&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  mixins<span class="token operator">:</span> <span class="token punctuation">[</span>demoMixin<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">&quot;Hello CodeTao&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;执行了App的created&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Hello CodeTao&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><img src="/frontEnd/frame/vue/64.png" alt=""></p> <h4 id="全局混入-mixin"><a href="#全局混入-mixin" class="header-anchor">#</a> 全局混入 Mixin</h4> <ul><li>如果组件中的某些选项，是所有的组件都需要拥有的，那么这个时候我们可以使用<strong>全局的 mixin</strong>：
<ul><li>全局的 Mixin 可以使用 <strong>应用 app 的方法 mixin</strong> 来完成注册；</li> <li>一旦注册，那么<strong>全局混入的选项将会影响每一个组件</strong>；</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;执行全局mixin的created&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/frontEnd/frame/vue/65.png" alt=""></p> <h2 id="extends"><a href="#extends" class="header-anchor">#</a> extends</h2> <ul><li>另外一个类似于 Mixin 的方式是通过 extends 属性：
<ul><li>允许声明扩展另外一个组件，<strong>类似于 Mixins</strong>；</li></ul></li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code>// extends/basePage.vue
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&quot;codertao&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{{ name }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>say<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>按钮<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> basePage <span class="token keyword">from</span> <span class="token string">&quot;./extends/basePage.vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> basePage<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><img src="/frontEnd/frame/vue/66.png" alt=""></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在开发中 extends 用的非常少，在 Vue2 中比较推荐大家使用 <strong>Mixin</strong>，而在 Vue3 中推荐使用 <strong>Composition API</strong>。</p></div> <h2 id="composition-api"><a href="#composition-api" class="header-anchor">#</a> Composition API</h2> <h4 id="options-api-的弊端"><a href="#options-api-的弊端" class="header-anchor">#</a> Options API 的弊端</h4> <ul><li>在 Vue2 中，我们编写组件的方式是 Options API：
<ul><li>Options API 的一大特点就是在<strong>对应的属性</strong>中编写<strong>对应的功能模块</strong>；</li> <li>比如 <strong>data 定义数据、methods 中定义方法、computed 中定义计算属性、watch 中监听属性改变</strong>，也包括<strong>生命周期钩子</strong>；</li></ul></li> <li>但是这种代码有一个很大的弊端：
<ul><li>当我们<strong>实现某一个功能</strong>时，这个功能<strong>对应的代码逻辑</strong>会被<strong>拆分到各个属性</strong>中；</li> <li>当我们<strong>组件变得更大、更复杂</strong>时，<strong>逻辑关注点的列表</strong>就会增长，那么<strong>同一个功能的逻辑就会被拆分的很分散</strong>；</li> <li>尤其对于那些一开始没<strong>有编写这些组件的人</strong>来说，这个组件的代码是<strong>难以阅读和理解</strong>的（阅读组件的其他人）；</li></ul></li> <li>下面我们来看一个非常大的组件，其中的逻辑功能按照颜色进行了划分：
<ul><li>这种<strong>碎片化的代码</strong>使用<strong>理解和维护这个复杂的组件</strong>变得异常困难，并且<strong>隐藏了潜在的逻辑问题</strong>；</li> <li>并且当我们<strong>处理单个逻辑关注点</strong>时，需要不断的<strong>跳到相应的代码</strong>块中；</li></ul></li></ul> <h4 id="大组件的逻辑分散"><a href="#大组件的逻辑分散" class="header-anchor">#</a> 大组件的逻辑分散</h4> <p><img src="/frontEnd/frame/vue/67.png" alt=""></p> <ul><li>如果我们能将<strong>同一个逻辑关注点相关的代码</strong> 收集<strong>在一起</strong>会更
好。</li> <li>这就是 Composition API 想
要做的事情，以及可以帮助我
们完成的事情。</li> <li>也有人把 Vue Composition
API 简称为<strong>VCA</strong>。</li></ul> <h3 id="认识-composition-api"><a href="#认识-composition-api" class="header-anchor">#</a> 认识 Composition API</h3> <ul><li>那么既然知道 Composition API 想要帮助我们做什么事情，接下来看一下到底是怎么做呢？
<ul><li>为了开始使用 Composition API，我们需要有一个可以实际使用它 <strong>（编写代码的地方</strong>；</li> <li>在 Vue 组件中，这个位置就是 <strong>setup 函数</strong>；</li></ul></li> <li>setup 其实就是组件的另外一个选项：
<ul><li>只不过这个选项强大到我们可以<strong>用它来替代之前所编写的大部分其他选项</strong>；</li> <li>比如<strong>methods、computed、watch、data、生命周期</strong>等等；</li></ul></li> <li>接下来我们一起学习这个函数的使用：
<ul><li>函数的参数</li> <li>函数的返回值</li></ul></li></ul> <h4 id="setup-函数的参数"><a href="#setup-函数的参数" class="header-anchor">#</a> setup 函数的参数</h4> <ul><li>我们先来研究一个 setup 函数的参数，它主要有两个参数：
<ul><li>第一个参数：<strong>props</strong></li> <li>第二个参数：<strong>context</strong></li></ul></li> <li>props 非常好理解，它其实就是父组件传递过来的属性会被放到 props 对象中，我们在 setup 中如果需要使用，那么就可
以直接通过 props 参数获取：
<ul><li>对于<strong>定义 props 的类型</strong>，我们还是<strong>和之前的规则是一样的，在 props 选项中定义</strong>；</li> <li>并且<strong>在 template 中</strong>依然是可以<strong>正常去使用 props 中的属性</strong>，比如 message；</li> <li>如果我们<strong>在 setup 函数中想要使用 props</strong>，那么<strong>不可以通过 this 去获取</strong>（后面我会讲到为什么）；</li> <li>因为 props 有直接<strong>作为参数传递到 setup 函数</strong>中，所以我们可以<strong>直接通过参数</strong>来使用即可；</li></ul></li> <li>另外一个参数是 context，我们也称之为是一个 SetupContext，它里面包含三个属性：
<ul><li><strong>attrs</strong>：所有的非 prop 的 attribute；</li> <li><strong>slots</strong>：父组件传递过来的插槽（这个在以渲染函数返回时会有作用，后面会讲到）；</li> <li><strong>emit</strong>：当我们组件内部需要发出事件时会用到 emit（因为我们不能访问 this，所以不可以通过 this.$emit 发出事件）</li></ul></li></ul> <h4 id="setup-函数的返回值"><a href="#setup-函数的返回值" class="header-anchor">#</a> setup 函数的返回值</h4> <ul><li>setup 既然是一个函数，那么它也可以有返回值，它的返回值用来做什么呢？
<ul><li>setup 的返回值可以在<strong>模板 template 中被使用</strong>；</li> <li>也就是说我们可以<strong>通过 setup 的返回值来替代 data 选项</strong>；</li></ul></li> <li>甚至是我们可以返回一个执行函数来代替在 methods 中定义的方法：</li></ul> <p><img src="/frontEnd/frame/vue/68.png" alt=""></p> <ul><li>但是，如果我们将 counter 在 increment 或者 decrement 进行操作时，是否可以实现界面的响应式呢？
<ul><li>答案是<strong>不可以</strong>；</li> <li>这是因为对于一个<strong>定义的变量</strong>来说，默认情况下，<strong>Vue 并不会跟踪它的变化，来引起界面的响应式操作</strong>；</li></ul></li></ul> <p><img src="/frontEnd/frame/vue/69.png" alt=""></p> <h4 id="setup-不可以使用-this"><a href="#setup-不可以使用-this" class="header-anchor">#</a> setup 不可以使用 this</h4> <ul><li>官方关于 this 有这样一段描述
<ul><li>表达的含义是 <strong>this 并没有指向当前组件实例</strong>；</li> <li>并且<strong>在 setup 被调用之前，data、computed、methods</strong> 等都没有被解析；</li> <li>所以<strong>无法在 setup 中获取 this</strong>；</li></ul></li></ul> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>在 setup 中你应该避免使用 this，因为它不会找到组件实例。setup 的调用发生在 data property、computed property 或 methods 被解析之前，所以它们无法在 setup 中被获取。</p></div> <h3 id="reactive-api"><a href="#reactive-api" class="header-anchor">#</a> Reactive API</h3> <ul><li>如果想为在 setup 中定义的数据提供响应式的特性，那么我们可以使用 reactive 的函数：</li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>当前计数:{{ state.counter }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>increment<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>+1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>decrement<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>-1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> reactive <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      counter<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>counter<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">decrement</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>counter<span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">,</span>
      increment<span class="token punctuation">,</span>
      decrement<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><img src="/frontEnd/frame/vue/70.gif" alt=""></p> <ul><li>那么这是什么原因呢？为什么就可以变成响应式的呢？
<ul><li>这是因为当我们<strong>使用 reactive 函数处理我们的数据之后</strong>，数据<strong>再次被使用</strong>时就会<strong>进行依赖收集</strong>；</li> <li>当<strong>数据发生改变</strong>时，所有<strong>收集到的依赖</strong>都是<strong>进行对应的响应式操作</strong>（比如更新界面）；</li> <li>事实上，我们编写的<strong>data 选项</strong>，也是在内部<strong>交给了 reactive 函数</strong>将其编程响应式对象的；</li></ul></li></ul> <h3 id="ref-api"><a href="#ref-api" class="header-anchor">#</a> Ref API</h3> <ul><li>reactive API 对传入的类型是有限制的，它要求我们必须传入的是一个对象或者数组类型：
<ul><li>如果我们传入一个<strong>基本数据类型（String、Number、Boolean）会报一个警告</strong>；</li></ul></li> <li>这个时候 Vue3 给我们提供了另外一个 API：ref API
<ul><li>ref 会返回一个<strong>可变的响应式对象</strong>，该对象作为一个 <strong>响应式的引用</strong> 维护着它<strong>内部的值</strong>，这就是<strong>ref 名称的来源</strong>；</li> <li>它内部的值是<strong>在 ref 的 value 属性</strong>中被维护的；</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>这里有两个注意事项：</li> <li>在<strong>模板中引入 ref 的值</strong>时，Vue 会<strong>自动帮助我们进行解包</strong>操作，所以我们并<strong>不需要在模板中通过 ref.value</strong> 的方式
来使用；</li> <li>但是在 <strong>setup 函数内部</strong>，它依然是一个 <strong>ref 引用</strong>， 所以对其进行操作时，我们依然需要<strong>使用 ref.value 的方式</strong>；</li></ul> <h4 id="ref-自动解包"><a href="#ref-自动解包" class="header-anchor">#</a> Ref 自动解包</h4> <ul><li>模板中的解包是浅层的解包，如果我们的代码是下面的方式：</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>当前计数:{{ info.counter }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token punctuation">{</span>
  counter<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/frontEnd/frame/vue/71.png" alt=""></p> <p>如果我们将 ref 放到一个 reactive 的属性当中，那么在模板中使用时，它会自动解包：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>当前计数:{{ reactiveInfo.counter }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> reactiveInfo <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  counter<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="readonly"><a href="#readonly" class="header-anchor">#</a> readonly</h3> <h4 id="认识-readonly"><a href="#认识-readonly" class="header-anchor">#</a> 认识 readonly</h4> <ul><li>我们通过 reactive 或者 ref 可以获取到一个响应式的对象，但是某些情况下，我们传入给其他地方（组件）的这个
响应式对象希望在另外一个地方（组件）被使用，但是不能被修改，这个时候如何防止这种情况的出现呢？
<ul><li>Vue3 为我们提供了 <strong>readonly 的方法</strong>；</li> <li><strong>readonly 会返回原生对象的只读代理</strong>（也就是它依然是一个 Proxy，这是一个 <strong>proxy 的 set 方法被劫持</strong>，并且不
能对其进行修改）；</li></ul></li> <li>在开发中常见的 readonly 方法会传入三个类型的参数：
<ul><li><strong>普通对象</strong>；</li> <li><strong>reactive 返回的对象</strong>；</li> <li><strong>ref 对象</strong>；</li></ul></li></ul> <h4 id="readonly-的使用"><a href="#readonly-的使用" class="header-anchor">#</a> readonly 的使用</h4> <ul><li>在 readonly 的使用过程中，有如下规则：
<ul><li>readonly<strong>返回的对象都是不允许修改</strong>的；</li> <li>但是经过 readonly 处理的<strong>原来的对象</strong>是允许被修改的；
<ul><li>比如 const info = readonly(obj)，<strong>info 对象是不允许被修改</strong>的；</li> <li>当<strong>obj 被修改</strong>时，<strong>readonly 返回的 info 对象</strong>也会被修改；</li> <li>但是我们<strong>不能去修改 readonly 返回的对象 info</strong>；</li></ul></li> <li>其实本质上就是<strong>readonly 返回的对象的 setter 方法</strong>被劫持了而已；</li></ul></li></ul> <p><img src="/frontEnd/frame/vue/72.png" alt=""></p> <h3 id="reactive-判断的-api"><a href="#reactive-判断的-api" class="header-anchor">#</a> Reactive 判断的 API</h3> <ul><li>isProxy
<ul><li>检查对象是否<strong>是由 reactive 或 readonly 创建的 proxy</strong>。</li></ul></li> <li>isReactive
<ul><li>检查对象<strong>是否是由 reactive 创建的响应式代理</strong>：</li> <li>如果<strong>该代理是 readonly 建的</strong>，但<strong>包裹了由 reactive 创建的另一个代理</strong>，它也会返回 true；</li></ul></li> <li>isReadonly
<ul><li>检查对象<strong>是否是由 readonly 创建的只读代理</strong>。</li></ul></li> <li>toRaw
<ul><li>返回 <strong>reactive 或 readonly 代理的原始对象</strong>（不建议保留对原始对象的持久引用。请谨慎使用）。</li></ul></li> <li>shallowReactive
<ul><li>创建一个响应式代理，它跟踪其自身 property 的响应性，但<strong>不执行嵌套对象的深层响应式转换</strong>(深层还是原生对象)。</li></ul></li> <li>shallowReadonly
<ul><li>创建一个 proxy，使其自身的 property 为只读，但<strong>不执行嵌套对象的深度只读转换</strong>（深层还是可读、可写的）。</li></ul></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这里就不做举例了,具体的实践开发的时候查一下文档就可以了</p></div> <h3 id="torefs"><a href="#torefs" class="header-anchor">#</a> toRefs</h3> <p>如果我们使用 ES6 的解构语法，对 reactive 返回的对象进行解构获取值，那么之后无论是修改结构后的变量，还是修改 reactive
返回的 state 对象，<strong>数据都不再是响应式</strong>的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;tao&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">19</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>那么有没有办法让我们解构出来的属性是响应式的呢？
<ul><li>Vue 为我们提供了一个<strong>toRefs 的函数</strong>，可以将<strong>reactive 返回的对象中的属性都转成 ref</strong>；</li> <li>那么我们再次进行结构出来的 <strong>name 和 age 本身都是 ref 的</strong>；</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;tao&quot;</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token number">19</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">toRefs</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这种做法相当于已经在 info.name 和 info.age 和 ref.value 之间建立了 <strong>链接</strong>，<strong>任何一个修改都会引起另外一个变化</strong>；</p> <p>所以我们通过 age.value 和 info.age 都可以修改 age 的值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">changeAge</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// age.value++;</span>
  info<span class="token punctuation">.</span>age<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>解构出了 name 和 age,如果我们想要使用 name 和 age,肯定要对其进行返回,这个在前面已经说过了,在使用了时候也是一样的,不需要使用 name.value 和 age.value 的形式来使用,因为 vue 自动帮我们进行了解包的操作,所以在 template 模板中可以直接使用 name,age 来进行使用</p> <p>下面还有一种更加<strong>优雅的写法</strong>(我自己认为比较优雅)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">toRefs</span><span class="token punctuation">(</span><span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;tao&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">19</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="toref"><a href="#toref" class="header-anchor">#</a> toRef</h3> <p>如果我们只希望转换一个 reactive 对象中的属性为 ref, 那么可以使用 toRef 的方法：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;tao&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">19</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token function">toRef</span><span class="token punctuation">(</span>info<span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>toRef 有两个参数,第一个参数是源响应对象,第二个参数是需要转换的属性</p> <p>当然也有优雅写法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token function">toRef</span><span class="token punctuation">(</span><span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;tao&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">19</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="ref-其他的-api"><a href="#ref-其他的-api" class="header-anchor">#</a> ref 其他的 API</h4> <ul><li>unref
<ul><li>如果我们想要获取一个 ref 引用中的 value，那么也可以通过 unref 方法：</li> <li><strong>如果参数是一个 ref</strong>，则<strong>返回内部值，否则返回参数本身</strong>；</li> <li>这是 <strong>val = isRef(val) ? val.value : val</strong> 的语法糖函数；</li></ul></li> <li>isRef
<ul><li>判断值<strong>是否是一个 ref 对象</strong></li></ul></li> <li>shallowRef
<ul><li>创建一个<strong>浅层的 ref 对象</strong>；</li></ul></li> <li>triggerRef
<ul><li><strong>手动触发和 shallowRef 相关联的副作用</strong>：</li></ul></li></ul> <p>很多 API 都不是很常用,具体开发的时候查一下文档使用就可以了</p> <p>这里我就简单说一下 shallowRef 和 triggerRef</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ info }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changeInfo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>改变info<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;tao&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">changeInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      info<span class="token punctuation">.</span>value<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;sandy&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      info<span class="token punctuation">,</span>
      changeInfo<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>默认情况下 ref 是可以深层响应的</p> <p>shallowRef 只会创建一个浅层的 ref 对象,不会对深层进行响应式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token function">shallowRef</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;tao&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">changeInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  info<span class="token punctuation">.</span>value<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;sandy&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 无法响应式</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>triggerRef: 手动触发和 shallowRef 相关联的副作用</p> <p>触发 shallowRef 的副作用,触发以后深层也会有响应式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">changeInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  info<span class="token punctuation">.</span>value<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;sandy&quot;</span><span class="token punctuation">;</span>
  <span class="token function">triggerRef</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="customref"><a href="#customref" class="header-anchor">#</a> customRef</h4> <ul><li>创建一个自定义的 ref，并对其依赖项跟踪和更新触发进行显示控制：
<ul><li>它需要一个工厂函数，该函数接受 track 和 trigger 函数作为参数；</li> <li>并且应该返回一个带有 get 和 set 的对象；</li></ul></li> <li>这里我们使用一个的案例：
<ul><li>对双向绑定的属性进行 debounce(节流)的操作；</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> customRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> delay <span class="token operator">=</span> <span class="token number">1000</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">customRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">track<span class="token punctuation">,</span> trigger</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">track</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          value <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
          <span class="token function">trigger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> debounceRef <span class="token keyword">from</span> <span class="token string">&quot;./hook/useDebounceRef&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// const title = ref(&quot;Hello World&quot;);</span>
    <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token function">debounceRef</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><img src="/frontEnd/frame/vue/73.gif" alt=""></p> <h3 id="computed"><a href="#computed" class="header-anchor">#</a> computed</h3> <ul><li>在前面我们讲解过计算属性 computed：当我们的某些属性是依赖其他状态时，我们可以使用计算属性来处理
<ul><li>在前面的 Options API 中，我们是使用 computed 选项来完成的；</li> <li>在 Composition API 中，我们可以在 setup 函数中使用 computed 方法来编写一个计算属性；</li></ul></li> <li>如何使用 computed 呢？
<ul><li>接收一个 getter 函数，并为 getter 函数返回的值，返回一个不变的 ref 对象；</li> <li>接收一个具有 get 和 set 的对象，返回一个可变的（可读写）ref 对象；</li></ul></li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ fullName }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changeName<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>切换name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> firstName <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;coder&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> lastName <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;tao&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> fullName <span class="token operator">=</span> firstName<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">&quot;&quot;</span> <span class="token operator">+</span> lastName<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">changeName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      fullName <span class="token operator">=</span> <span class="token string">&quot;sandy&quot;</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fullName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      fullName<span class="token punctuation">,</span>
      changeName<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>如果我们使用传统的 ref 来处理值的时候是没有响应式的</p> <p><img src="/frontEnd/frame/vue/74.png" alt=""></p> <p>这个时候可能会想到用 computed,在 setup 中是这样使用 computed 的</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 用法一: 传一个getter函数</span>
<span class="token comment">// const fullName = computed(() =&gt; firstName.value + &quot;&quot; + lastName.value);</span>
<span class="token comment">// 用法二: 传一个对象,对象包含getter和setter</span>
<span class="token keyword">const</span> fullName <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> firstName<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">&quot;&quot;</span> <span class="token operator">+</span> lastName<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> names <span class="token operator">=</span> newValue<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    firstName<span class="token punctuation">.</span>value <span class="token operator">=</span> names<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    lastName<span class="token punctuation">.</span>value <span class="token operator">=</span> names<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">changeName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  fullName<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&quot;san dy&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/frontEnd/frame/vue/75.gif" alt=""></p> <h3 id="watcheffect"><a href="#watcheffect" class="header-anchor">#</a> watchEffect</h3> <h4 id="侦听数据的变化"><a href="#侦听数据的变化" class="header-anchor">#</a> 侦听数据的变化</h4> <ul><li>在前面的 Options API 中，我们可以通过 watch 选项来侦听 data 或者 props 的数据变化，当数据变化时执行某一些
操作。</li> <li>在 Composition API 中，我们可以使用 watchEffect 和 watch 来完成响应式数据的侦听；
<ul><li>watch 需要手动指定侦听的数据源；</li> <li>watchEffect 用于<strong>自动收集</strong>响应式数据的依赖；</li></ul></li></ul> <h4 id="watcheffect-2"><a href="#watcheffect-2" class="header-anchor">#</a> watchEffect</h4> <ul><li><p>当侦听到某些响应式数据变化时，我们希望执行某些操作，这个时候可以使用 watchEffect。</p></li> <li><p>我们来看一个案例：</p> <ul><li>首先，watchEffect 传入的函数会被<strong>立即执行</strong>一次，并且在执行的过程中会<strong>收集依赖</strong>；</li> <li>其次，只有收集的<strong>依赖发生变化</strong>时，watchEffect 传入的函数才会再次执行；</li></ul></li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ name }}-{{ age }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changeName<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>改变name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changeAge<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>改变age<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> watchEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;tao&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token function-variable function">changeName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&quot;sandy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">changeAge</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> age<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span>

    <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      name<span class="token punctuation">,</span>
      age<span class="token punctuation">,</span>
      changeName<span class="token punctuation">,</span>
      changeAge<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><img src="/frontEnd/frame/vue/76.gif" alt=""></p> <h4 id="watcheffect-的停止侦听"><a href="#watcheffect-的停止侦听" class="header-anchor">#</a> watchEffect 的停止侦听</h4> <ul><li>如果在发生某些情况下，我们希望停止侦听，这个时候我们可以获取 watchEffect 的返回值函数，调用该函数即可。</li> <li>比如在上面的案例中，我们 age 达到 30 的时候就停止侦听：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">changeAge</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  age<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>age<span class="token punctuation">.</span>value <span class="token operator">&gt;</span> <span class="token number">30</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> stop <span class="token operator">=</span> <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;name:&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token string">&quot;age:&quot;</span><span class="token punctuation">,</span> age<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/frontEnd/frame/vue/77.gif" alt=""></p> <h4 id="watcheffect-清除副作用"><a href="#watcheffect-清除副作用" class="header-anchor">#</a> watchEffect 清除副作用</h4> <ul><li>什么是清除副作用呢？
<ul><li>比如在开发中我们需要在侦听函数中执行网络请求，但是在网络请求还没有达到的时候，我们停止了侦听器，
或者侦听器侦听函数被再次执行了。</li> <li>那么上一次的网络请求应该被取消掉，这个时候我们就可以清除上一次的副作用；</li></ul></li> <li>在我们给 watchEffect 传入的函数被回调时，其实可以获取到一个参数：onInvalidate
<ul><li>当<strong>副作用即将重新执行</strong> 或者 <strong>侦听器被停止</strong> 时会执行该函数传入的回调函数；</li> <li>我们可以在传入的回调函数中，执行一些清楚工作；</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> stop <span class="token operator">=</span> <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">onInvalidate</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 根据name和age两个变量的监听发送网络请求</span>
  <span class="token comment">// 如果我们不清除副作用的话</span>
  <span class="token comment">// 比如我们刚进来发送网络请求，age发送了变化，就会又发送一次网络请求，然后不断发生变化，就会一直发送网络请求</span>
  <span class="token comment">// 那么就可能发送很多次的网络请求，所以要清除副作用（有点防抖的那个意思了)</span>

  <span class="token comment">// 通过定时器模拟发送网络请求</span>
  <span class="token keyword">const</span> timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;网络请求成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">onInvalidate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在这个函数中清除副作用</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;清除上一次的网络请求&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;name:&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">.</span>value<span class="token punctuation">,</span> <span class="token string">&quot;age:&quot;</span><span class="token punctuation">,</span> age<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="/frontEnd/frame/vue/78.gif" alt=""></p> <h4 id="setup-中使用-ref"><a href="#setup-中使用-ref" class="header-anchor">#</a> setup 中使用 ref</h4> <ul><li>在讲解 watchEffect 执行时机之前，我们先补充一个知识：在 setup 中如何使用 ref 或者元素或者组件？
<ul><li>其实非常简单，我们只需要定义一个 ref 对象，绑定到元素或者组件的 ref 属性上即可；</li></ul></li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Hello World<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> watchEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// setup函数是在DOM挂载以前就已经完成了</span>
    <span class="token comment">// 具体后面讲生命周期会说到</span>
    <span class="token comment">// 所以立即执行第一次打印的就是null</span>
    <span class="token comment">// 因为我DOM还没挂载出来，DOM的元素就不会赋值到value里面，所以第一次打印就是一个null</span>
    <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      title<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="watcheffect-的执行时机"><a href="#watcheffect-的执行时机" class="header-anchor">#</a> watchEffect 的执行时机</h4> <ul><li>默认情况下，组件的更新会在副作用函数执行之前：
<ul><li>如果我们希望在副作用函数中获取到元素，是否可行呢？</li></ul></li></ul> <ul><li>我们会发现打印结果打印了两次：
<ul><li>这是因为 setup 函数在执行时就会立即执行传入的副作用函数，这个时候 DOM 并没有挂载，所以打印为 null；</li> <li>而当 DOM 挂载时，会给 title 的 ref 对象赋值新的值，副作用函数会再次执行，打印出来对应的元素；</li></ul></li></ul> <p><img src="/frontEnd/frame/vue/79.png" alt=""></p> <h5 id="调整-watcheffect-的执行时机"><a href="#调整-watcheffect-的执行时机" class="header-anchor">#</a> 调整 watchEffect 的执行时机</h5> <ul><li>如果我们希望在第一次的时候就打印出来对应的元素呢？
<ul><li>这个时候我们需要改变副作用函数的执行时机；</li> <li>它的默认值是 pre，它会在元素 挂载 或者 更新 之前执行；</li> <li>所以我们会先打印出来一个空的，当依赖的 title 发生改变时，就会再次执行一次，打印出元素；</li></ul></li> <li>我们可以设置副作用函数的执行时机：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">watchEffect</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    flush<span class="token operator">:</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>flush 选项还接受 sync，这将强制效果始终同步触发。然而，这是<strong>低效的</strong>，应该很少需要。</p> <h3 id="watch"><a href="#watch" class="header-anchor">#</a> Watch</h3> <ul><li>watch 的 API 完全等同于组件 watch 选项的 Property：
<ul><li>watch 需要侦听特定的数据源，并在回调函数中执行副作用；</li> <li>默认情况下它是惰性的，只有当被侦听的源发生变化时才会执行回调；</li></ul></li> <li>与 watchEffect 的比较，watch 允许我们：
<ul><li>懒执行副作用（第一次不会直接执行）；</li> <li>更具体的说明当哪些状态发生变化时，触发侦听器的执行；</li> <li>访问侦听状态变化前后的值；</li></ul></li></ul> <h4 id="侦听单个数据源"><a href="#侦听单个数据源" class="header-anchor">#</a> 侦听单个数据源</h4> <ul><li>watch 侦听函数的数据源有两种类型：
<ul><li>一个 <strong>getter 函数</strong>：但是该 getter 函数必须引用可响应式的对象（比如 reactive 或者 ref）；</li> <li>直接写入一个<strong>可响应式的对象</strong>，reactive 或者 ref（比较常用的是 ref）；</li></ul></li></ul> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ info.name }}-{{ info.age }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{{ age }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changeData<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>修改数据<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span> watch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;tao&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">19</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 1.传入一个getter函数</span>
    <span class="token comment">// watch(</span>
    <span class="token comment">//   () =&gt; info.age,</span>
    <span class="token comment">//   (newValue, oldValue) =&gt; {</span>
    <span class="token comment">//     console.log(&quot;newValue:&quot;, newValue, &quot;oldValue:&quot;, oldValue);</span>
    <span class="token comment">//   }</span>
    <span class="token comment">// );</span>

    <span class="token comment">// 2.传入一个可响应式对象: reactive对象/ref对象</span>
    <span class="token comment">// 情况一: reactive对象获取到的newValue和oldVlaue本身就是reactive对象</span>
    <span class="token comment">// watch(info, (newValue, oldValue) =&gt; {</span>
    <span class="token comment">//   console.log(&quot;newValue:&quot;, newValue, &quot;oldValue:&quot;, oldValue);</span>
    <span class="token comment">// });</span>
    <span class="token comment">// 如果我们希望newValue和oldValue是一个普通的对象</span>
    <span class="token comment">// watch(</span>
    <span class="token comment">//   () =&gt; {</span>
    <span class="token comment">//     return { ...info };</span>
    <span class="token comment">//   },</span>
    <span class="token comment">//   (newValue, oldValue) =&gt; {</span>
    <span class="token comment">//     console.log(&quot;newValue:&quot;, newValue, &quot;oldValue:&quot;, oldValue);</span>
    <span class="token comment">//   }</span>
    <span class="token comment">// );</span>
    <span class="token comment">// 情况二: ref对象获取到的newValue和oldValue是value值的本身</span>
    <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">watch</span><span class="token punctuation">(</span>age<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;newValue:&quot;</span><span class="token punctuation">,</span> newValue<span class="token punctuation">,</span> <span class="token string">&quot;oldValue:&quot;</span><span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token function-variable function">changeData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// info.age++;</span>
      age<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      info<span class="token punctuation">,</span>
      age<span class="token punctuation">,</span>
      changeData<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h5 id="侦听多个数据源"><a href="#侦听多个数据源" class="header-anchor">#</a> 侦听多个数据源</h5> <p>侦听器还可以使用数组同时侦听多个源</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">[</span>info<span class="token punctuation">,</span> age<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;newValue:&quot;</span><span class="token punctuation">,</span> newValue<span class="token punctuation">,</span> <span class="token string">&quot;oldValue:&quot;</span><span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="侦听响应式对象"><a href="#侦听响应式对象" class="header-anchor">#</a> 侦听响应式对象</h4> <p>如果我们希望侦听一个数组或者对象，那么可以使用一个 getter 函数，并且对可响应对象进行解构：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>info <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> age<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>newInfo<span class="token punctuation">,</span> newAge<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>oldInfo<span class="token punctuation">,</span> oldAge<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newInfo<span class="token punctuation">,</span> newAge<span class="token punctuation">,</span> oldInfo<span class="token punctuation">,</span> oldAge<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="watch-的选项"><a href="#watch-的选项" class="header-anchor">#</a> watch 的选项</h4> <ul><li>如果我们希望侦听一个深层的侦听，那么依然需要设置 deep 为 true：
<ul><li>也可以传入 immediate 立即执行；</li></ul></li></ul> <p>如果我们使用 reactive 对象来进行监听的话,默认情况下是可以深度监听的,因为在源码已经添加了 deep 为 true</p> <p>但是如果我们是用普通的对象来想要进行深度监听的话,这个时候就需要设置额外的选项了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">watch</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>info <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;newValue:&quot;</span><span class="token punctuation">,</span> newValue<span class="token punctuation">,</span> <span class="token string">&quot;oldValue:&quot;</span><span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    deep<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    immediate<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021年6月22日星期二上午10点16分</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/frontEnd/frame/vue/animation.html" class="prev">
        动画
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.cce02172.js" defer></script><script src="/assets/js/2.032fb0bf.js" defer></script><script src="/assets/js/31.c07bebee.js" defer></script>
  </body>
</html>
